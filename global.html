<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Global - Documentation</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#onRequest">onRequest</a></li><li><a href="global.html#onResponse">onResponse</a></li><li><a href="global.html#onSchedule">onSchedule</a></li><li><a href="global.html#onSessionCompleted">onSessionCompleted</a></li></ul><h3>Classes</h3><ul><li><a href="Body.html">Body</a><ul class='methods'><li data-type='method'><a href="Body.html#parseJSON">parseJSON</a></li><li data-type='method'><a href="Body.html#parseText">parseText</a></li><li data-type='method'><a href="Body.html#parseURLSearchParams">parseURLSearchParams</a></li></ul></li><li><a href="CompletedContext.html">CompletedContext</a><ul class='methods'><li data-type='method'><a href="CompletedContext.html#scriptName">scriptName</a></li><li data-type='method'><a href="CompletedContext.html#session">session</a></li></ul></li><li><a href="HTTPClient.html">HTTPClient</a><ul class='methods'><li data-type='method'><a href="HTTPClient.html#.delete">delete</a></li><li data-type='method'><a href="HTTPClient.html#.get">get</a></li><li data-type='method'><a href="HTTPClient.html#.post">post</a></li><li data-type='method'><a href="HTTPClient.html#.put">put</a></li><li data-type='method'><a href="HTTPClient.html#.request">request</a></li><li data-type='method'><a href="HTTPClient.html#.update">update</a></li></ul></li><li><a href="Headers.html">Headers</a><ul class='methods'><li data-type='method'><a href="Headers.html#append">append</a></li><li data-type='method'><a href="Headers.html#delete">delete</a></li><li data-type='method'><a href="Headers.html#encode">encode</a></li><li data-type='method'><a href="Headers.html#entries">entries</a></li><li data-type='method'><a href="Headers.html#forEach">forEach</a></li><li data-type='method'><a href="Headers.html#get">get</a></li><li data-type='method'><a href="Headers.html#has">has</a></li><li data-type='method'><a href="Headers.html#keys">keys</a></li><li data-type='method'><a href="Headers.html#set">set</a></li><li data-type='method'><a href="Headers.html#values">values</a></li></ul></li><li><a href="Request.html">Request</a><ul class='methods'><li data-type='method'><a href="Request.html#body">body</a></li><li data-type='method'><a href="Request.html#headers">headers</a></li><li data-type='method'><a href="Request.html#host">host</a></li><li data-type='method'><a href="Request.html#method">method</a></li><li data-type='method'><a href="Request.html#path">path</a></li><li data-type='method'><a href="Request.html#port">port</a></li><li data-type='method'><a href="Request.html#queries">queries</a></li><li data-type='method'><a href="Request.html#scheme">scheme</a></li></ul></li><li><a href="Response.html">Response</a><ul class='methods'><li data-type='method'><a href="Response.html#body">body</a></li><li data-type='method'><a href="Response.html#headers">headers</a></li><li data-type='method'><a href="Response.html#statusCode">statusCode</a></li><li data-type='method'><a href="Response.html#statusPhrase">statusPhrase</a></li></ul></li><li><a href="RewriteContext.html">RewriteContext</a><ul class='methods'><li data-type='method'><a href="RewriteContext.html#isEnableOnRequest">isEnableOnRequest</a></li><li data-type='method'><a href="RewriteContext.html#isEnableOnResponse">isEnableOnResponse</a></li><li data-type='method'><a href="RewriteContext.html#parameters">parameters</a></li><li data-type='method'><a href="RewriteContext.html#scriptName">scriptName</a></li></ul></li><li><a href="ScheduleContext.html">ScheduleContext</a><ul class='methods'><li data-type='method'><a href="ScheduleContext.html#parameters">parameters</a></li><li data-type='method'><a href="ScheduleContext.html#repeatedCount">repeatedCount</a></li><li data-type='method'><a href="ScheduleContext.html#scriptName">scriptName</a></li></ul></li><li><a href="SharedPreferences.html">SharedPreferences</a><ul class='methods'><li data-type='method'><a href="SharedPreferences.html#.read">read</a></li><li data-type='method'><a href="SharedPreferences.html#.write">write</a></li></ul></li><li><a href="URLSearchParams.html">URLSearchParams</a><ul class='methods'><li data-type='method'><a href="URLSearchParams.html#append">append</a></li><li data-type='method'><a href="URLSearchParams.html#delete">delete</a></li><li data-type='method'><a href="URLSearchParams.html#entries">entries</a></li><li data-type='method'><a href="URLSearchParams.html#forEach">forEach</a></li><li data-type='method'><a href="URLSearchParams.html#get">get</a></li><li data-type='method'><a href="URLSearchParams.html#has">has</a></li><li data-type='method'><a href="URLSearchParams.html#keys">keys</a></li><li data-type='method'><a href="URLSearchParams.html#set">set</a></li><li data-type='method'><a href="URLSearchParams.html#sort">sort</a></li><li data-type='method'><a href="URLSearchParams.html#toString">toString</a></li><li data-type='method'><a href="URLSearchParams.html#values">values</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">Global</h1>
    

    




<section>

<header>
    
        <h2>
        
            
        
        </h2>
        
    
</header>

<article>
    
        <div class="container-overview">
        
            

<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




            

            
        
        </div>
    

    

    

    
    
    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="onRequest"><span class="type-signature type-signature-async">(async) </span>onRequest<span class="signature">(context, url, request)</span><span class="type-signature"> &rarr; {Promise.&lt;<a href="Request.html">Request</a>>}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li>Design for "Rewrite Script". 
This function is called before the HTTP request is sent to the server.
If you do not modify the request, you should delete this function to avoid unnecessary calls.</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>async function onRequest(context, url, request) {
        console.log(url);
        // pass parameters to onResponse
        context.parameters["custom"] = "custom parameters"
        
        // redirect
        request.scheme = "https"
        request.path = "/upload/json"
        request.host = "www.google.com"
        request.port = 443
        
        // queries
        request.queries.append("appendname", "appendvalue")
        request.queries.set("replacename", "replacevalue")
        request.queries.get("name")
        request.queries.delete("name")
        request.queries.has("name")
        
        // headers has same function like queries
        request.headers.delete("accept")
        request.headers.append("headname", "headvalue")
        request.headers.forEach((value, name) => {
            console.log(`${name}: ${value}`);
        });

        // parse body to json object
        var json = request.body.parseJSON()
        json["script_json"] = "JSONValue"
        request.body = json
        // Done
        return request;
    }</code></pre>




    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>context</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="RewriteContext.html">RewriteContext</a></span>



            
            </td>

            

            

            <td class="description last">The context object.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last">The URL of the HTTP request.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>request</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Request.html">Request</a></span>



            
            </td>

            

            

            <td class="description last">The HTTP request object.</td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    - A promise that resolves when the function execution is completed.
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;<a href="Request.html">Request</a>></span>



    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="onResponse"><span class="type-signature type-signature-async">(async) </span>onResponse<span class="signature">(context, url, response)</span><span class="type-signature"> &rarr; {Promise.&lt;<a href="Response.html">Response</a>>}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li>Design for "Rewrite Script". 
This function is called before the HTTP response is sent to the client.
If you do not modify the response, you should delete this function to avoid unnecessary calls.</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>async function onResponse(context, url, response) {
      console.log(`onResponse ${url}`);
      // get parameters from onRequest
      for (var prop in context.parameters) {
          console.log(prop + ': ' + context.parameters[prop]);
      }
      // body
      // URLSearchParams has same function like queries
      var urlencoded = response.body.parseURLSearchParams()
      urlencoded.append("script", "parseURLSearchParams")
      response.body = urlencoded
      // Done
      return response;
  }</code></pre>




    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>context</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="RewriteContext.html">RewriteContext</a></span>



            
            </td>

            

            

            <td class="description last">The context object.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last">The URL of the HTTP response.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>response</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Response.html">Response</a></span>



            
            </td>

            

            

            <td class="description last">The HTTP response object.</td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    - A promise that resolves when the function execution is completed.
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;<a href="Response.html">Response</a>></span>



    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="onSchedule"><span class="type-signature type-signature-async">(async) </span>onSchedule<span class="signature">(context)</span><span class="type-signature"> &rarr; {Promise.&lt;void>}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li>Design for "Schedule Script". 
This function will be called at the scheduled timer trigger time.
It is mainly used to perform some scheduled tasks.</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>async function onSchedule(context) {
      /// print custom parameters
      for (var prop in context.parameters) {
          console.log(`${prop}: ${context.parameters[prop]}`);
      }
      /// custom parameters
      context.parameters["custom"] = "custom parameters for next runloop";
      /// scriptName
      console.log(`scriptName ${context.scriptName}`);
      /// repeatedCount
      console.log(`repeatedCount ${context.repeatedCount}`);
      /// abort schedule
      if (context.repeatedCount == 2) {
          abort()
      }
  }</code></pre>




    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>context</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="ScheduleContext.html">ScheduleContext</a></span>



            
            </td>

            

            

            <td class="description last">The context object.</td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    - A promise that resolves when the function execution is completed.
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;void></span>



    </dd>
</dl>

    



        
            

    

    <h4 class="name" id="onSessionCompleted"><span class="type-signature type-signature-async">(async) </span>onSessionCompleted<span class="signature">(context, url, request, response)</span><span class="type-signature"> &rarr; {Promise.&lt;void>}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li>Design for "HTTP Completed Script". 
This function is called after the HTTP response is returned.
It can be used for HTTP data collection.</li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// sample of pass data to local http server
async function onSessionCompleted(context, url, request, response) {
    try {
        var reqBody = request.body.parseText();
        var rspBody = response.body.parseText()
        var params = {
            "body" : {
                "url": url,
                "reqHeader": request.headers.encode(),
                "reqBody": reqBody,
                "rspHeader": response.headers.encode(),
                "rspBody": rspBody,
            },
            "headers": {"from": "onSessionCompleted"},
        }
        // send http session data to other server
        const rsp = await HTTPClient.post("http://192.168.3.30:8000/upload", params)
        let json = rsp.body.parseText()
    } catch(error) {
        console.log(error)
    }
}</code></pre>




    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>context</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="CompletedContext.html">CompletedContext</a></span>



            
            </td>

            

            

            <td class="description last">The context object.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last">The URL of the HTTP request.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>request</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Request.html">Request</a></span>



            
            </td>

            

            

            <td class="description last">The HTTP request object.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>response</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="Response.html">Response</a></span>



            
            </td>

            

            

            <td class="description last">The HTTP response object.</td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    - A promise that resolves when the function execution is completed.
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;void></span>



    </dd>
</dl>

    



        
    

    

    
</article>

</section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Wed Apr 24 2024 12:24:06 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>